# Fretboard Scale Visualizer - Project Context

> **IMPORTANT**: This file should be reviewed at the start of each coding session to maintain project continuity, track features, and ensure alignment with goals.

## Project Goals Summary

A comprehensive, modular web application for visualizing musical scales, chords, intervals, and patterns on stringed instruments. The primary focus is on:
- **Universal instrument support** (any stringed instrument with custom tunings)
- **Comprehensive scale visualization** (30+ scales including modes, pentatonic, blues, jazz, Eastern, African)
- **Advanced visualization features** (chords, intervals, patterns, frequency analysis)
- **Modular, maintainable architecture** (easy to modify and extend)
- **Interactive note exploration** (click notes for detailed information)

## Current Architecture

### File Structure
- `scales.js` - Scale definitions and calculations (30+ scales)
- `instruments.js` - Instrument configurations and note calculations
- `visualization.js` - Scale highlighting overlay system
- `circle-of-fifths.js` - Circle of fifths and chromatic circle visualizations
- `chords.js` - Chord visualization and analysis
- `intervals.js` - Interval highlighting system
- `patterns.js` - Scale pattern detection (CAGED, 3-note-per-string)
- `frequency.js` - Note frequency analysis across fretboard
- `tuning-editor.js` - Custom tuning editor with localStorage
- `note-interactions.js` - Note click interactions and info panel
- `script.js` - Main controller integrating all modules
- `styles.css` - All styling (visual styles, scale highlighting, UI components)
- `index.html` - Main UI structure

### Key Design Principles
1. **Modularity**: Each feature in separate file for easy modification
2. **Separation of Concerns**: Scales, instruments, visualization, and UI are independent
3. **No External Dependencies**: Pure JavaScript, runs in browser
4. **Extensibility**: Easy to add new scales, instruments, visualizations

## Feature Status

### âœ… Completed Features
- [x] Multi-instrument support (Guitar, Mandolin, Banjo, Ukulele, Bass)
- [x] 30+ scale definitions (Major modes, Pentatonic, Blues, Jazz, Eastern, African)
- [x] 20-fret fretboard visualization
- [x] Scale highlighting with root note emphasis
- [x] Key and scale selection via dropdowns
- [x] Multiple visual styles (Classic, Colorful, Minimal, Bold, Circular)
- [x] Settings panel with collapsible UI
- [x] Chord visualization overlay
- [x] Interval highlighting
- [x] Scale pattern detection (CAGED)
- [x] Note frequency analysis
- [x] Custom tuning editor with localStorage persistence
- [x] Circle of fifths visualization
- [x] Chromatic circle visualization
- [x] **Note click interactions** - Click notes to see info panel with:
  - Position information
  - Scale degree and interval from root
  - All positions of the note
  - Action buttons (highlight all, show intervals, find chords)

### ðŸš§ Planned Features
- [x] Scale degree labels on fretboard (âœ… Implemented with fault tolerance)
- [ ] Arpeggio pattern visualization
- [ ] Chord progression analysis
- [x] Fret markers and position indicators (âœ… Implemented with fault tolerance)
- [ ] Export/print functionality
- [ ] Scale comparison mode
- [ ] Audio playback integration
- [ ] Multi-note selection
- [ ] Note sequence builder
- [ ] Chord voicing suggestions
- [x] Chord library system (âœ… Comprehensive chord definitions)
- [x] MIDI note visualization/I/O (âœ… Foundation implemented)

## Recent Decisions & Notes

### Design Decisions
1. **20 frets** - Increased from 12 to provide more range
2. **Minimal style as default** - Clean, unobtrusive visualization
3. **Modular file structure** - Each feature in separate file for maintainability
4. **LocalStorage for custom tunings** - Persist user-created instruments
5. **Info panel on note click** - Fixed position, non-intrusive
6. **Settings panel** - Collapsible to keep UI clean

### Technical Notes
- All note calculations use 12-tone equal temperament
- Scale definitions use semitone intervals from root
- Fretboard displays strings bottom-to-top (lowest to highest)
- Note interactions use event delegation for performance
- Visualizations can be toggled independently

### Known Considerations
- Circle visualizations use SVG for scalability
- Note click handlers are re-attached when fretboard is recreated
- Custom tunings are saved to localStorage (browser-specific)
- All visualizations update when key/scale/instrument changes

## Reminders & TODOs

### Before Each Session
- [ ] Review this file for project context
- [ ] Check README.md for current feature list
- [ ] Verify all modules are properly integrated
- [ ] Test note interactions after any fretboard changes

### Code Quality Checks
- [ ] Maintain modular architecture (don't mix concerns)
- [ ] Keep functions focused and single-purpose
- [ ] Add comments for complex logic
- [ ] Ensure responsive design works on mobile
- [ ] Test with different instruments and scales

### Documentation Updates Needed
- [ ] Update README.md when adding major features
- [ ] Document new scale definitions in scales.js comments
- [ ] Add usage examples for new features
- [ ] Update this file when making architectural changes

## Common Patterns & Conventions

### Naming Conventions
- Classes: `PascalCase` (e.g., `ScaleManager`)
- Methods: `camelCase` (e.g., `getScaleNotes`)
- CSS classes: `kebab-case` (e.g., `note-selected`)
- Data attributes: `data-note`, `data-string`, `data-fret`

### Module Integration Pattern
```javascript
// In script.js constructor:
this.moduleName = new ModuleName(dependencies);

// In init():
this.setupModuleName();

// Methods follow pattern:
setupModuleName() { /* setup code */ }
updateModuleName() { /* update code */ }
```

### Visualization Pattern
1. Clear previous visualization
2. Get current state (key, scale, instrument)
3. Calculate visualization data
4. Apply to DOM elements
5. Update related visualizations (e.g., circles)

## Testing Checklist

When adding new features, verify:
- [ ] Works with all instrument types
- [ ] Updates correctly when key/scale changes
- [ ] Doesn't break existing visualizations
- [ ] Responsive on mobile devices
- [ ] Info panel displays correctly
- [ ] Note interactions work smoothly
- [ ] Custom tunings persist correctly

## Quick Reference

### Current Defaults
- Instrument: Guitar (Standard) - EADGBE
- Key: C
- Scale: Major (Ionian)
- Visual Style: Minimal (Version 3)
- Frets: 20

### Key Methods to Know
- `scaleManager.getScaleNotes(key, scale)` - Get notes in scale
- `instrumentManager.getNote(tuning, stringIndex, fret)` - Calculate note
- `scaleVisualizer.applyScale(element, notes, root, style)` - Highlight scale
- `noteInteractionManager.setupNoteClicks(element)` - Enable note clicks

### Important Data Structures
- `allNotes`: `['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B']`
- Scales defined as semitone intervals from root: `[0, 2, 4, 5, 7, 9, 11]` (Major)

---

**Last Updated**: After implementing scale degrees, fret markers, chord library, and MIDI support
**Next Priority**: Arpeggio patterns, chord progressions, export/print functionality
